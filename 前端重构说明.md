# 前端页面重构说明

## 重构日期
2025年11月15日

## 重构目标
将原本臃肿的单页应用（index.html）拆分为4个独立的页面，每个页面负责一个功能模块，实现代码分离和职责清晰。

## 新的项目结构

```
frontend/
├── index.html              # 编辑续写模式（主页）
├── create.html             # 创作小说模式
├── history.html            # 历史对话模式
├── logs.html               # 日志管理模式
├── index_old.html          # 旧版本备份（可删除）
├── css/
│   ├── common.css          # 所有页面共用样式（头部、侧边栏、按钮、模态框）
│   ├── edit.css            # 编辑续写专用样式
│   ├── create.css          # 创作小说专用样式
│   ├── history.css         # 历史对话专用样式
│   ├── logs.css            # 日志管理专用样式
│   └── style.css           # 旧版本样式（可删除）
└── js/
    ├── common.js           # 所有页面共用脚本（侧边栏折叠、模态框、Toast提示）
    ├── edit.js             # 编辑续写专用脚本（原main.js的核心功能）
    ├── history.js          # 历史对话专用脚本
    ├── logs.js             # 日志管理专用脚本
    ├── logger.js           # 日志记录工具（保持不变）
    ├── api.js              # API调用工具（保持不变）
    └── main.js             # 旧版本脚本（可删除）
```

## 各页面功能说明

### 1. index.html - 编辑续写模式
**职责**: AI对话续写、剧情设计、上下文管理
**主要功能**:
- 双标签页切换（剧情设计 / 生成原文）
- AI对话历史展示
- 提示词输入和发送
- 附加上下文管理（原文章节、剧情梗概、当前剧情）
- 悬浮按钮（加载小说、剧情库、剧情定稿）
- 小说文件上传和章节选择
- 剧情库管理
- 剧情定稿管理

**CSS依赖**: `common.css`, `edit.css`
**JS依赖**: `common.js`, `logger.js`, `edit.js`, `marked.js`

### 2. create.html - 创作小说模式
**职责**: 从头创作全新小说（待开发）
**当前状态**: 占位页面
**CSS依赖**: `common.css`, `create.css`
**JS依赖**: `common.js`

### 3. history.html - 历史对话模式
**职责**: 查看和管理历史对话记录
**主要功能**:
- 左侧历史列表显示
- 右侧对话详情展示
- 清空历史记录
- localStorage持久化

**CSS依赖**: `common.css`, `history.css`
**JS依赖**: `common.js`, `history.js`, `marked.js`

### 4. logs.html - 日志管理模式
**职责**: 查看和管理前后端日志
**主要功能**:
- 前端/后端日志切换
- 刷新日志
- 清空日志
- 下载日志

**CSS依赖**: `common.css`, `logs.css`
**JS依赖**: `common.js`, `logs.js`

## 共用组件说明

### common.css
包含所有页面共用的样式：
- CSS变量定义（颜色、尺寸）
- 头部导航栏样式
- 侧边栏样式
- 按钮样式（btn, btn-sm, btn-secondary, btn-danger）
- 模态框样式
- 占位页面样式
- 工具类（hidden）

### common.js
包含所有页面共用的功能：
- `initSidebarToggle()`: 侧边栏折叠功能
- `highlightCurrentPage()`: 高亮当前页面菜单项
- `openModal(modalId)`: 打开模态框
- `closeModal(modalId)`: 关闭模态框
- `formatTimestamp(timestamp)`: 格式化时间戳
- `showToast(message, type)`: 显示Toast提示

## 导航系统

侧边栏导航已改为页面跳转链接：
- **编辑续写** → `index.html`
- **创作小说** → `create.html`
- **历史对话** → `history.html`
- **日志管理** → `logs.html`

每个页面的侧边栏会自动高亮当前页面对应的菜单项（通过`common.js`实现）。

## 数据持久化

使用localStorage存储的数据：
- `novel_assist_current_novel`: 当前加载的小说和选中的章节
- `novel_assist_plot_context`: 剧情库数据
- `novel_assist_context_labels`: 自定义的上下文标签
- `novel_assist_conversation_history`: 历史对话记录

所有页面共享同一个localStorage数据源。

## 优势

1. **代码清晰**: 每个页面只负责一个功能，代码量大幅减少
2. **易于维护**: 修改某个功能时只需要改对应的文件，不会影响其他功能
3. **性能优化**: 每个页面只加载必要的CSS和JS，减少资源浪费
4. **扩展性强**: 未来添加新功能时直接创建新页面即可
5. **调试方便**: 每个模块独立，问题定位更准确

## 兼容性

- 保留了所有原有功能
- localStorage数据结构未改变
- 后端API调用方式未改变
- 与旧版本数据完全兼容

## 下一步计划

1. 测试所有页面功能是否正常
2. 完善create.html的创作小说功能
3. 考虑删除旧文件（index_old.html, style.css, main.js）
4. 优化页面加载性能
5. 添加页面间的数据同步机制（如有需要）

## 注意事项

- 旧版本文件（index_old.html, main.js, style.css）已备份但未删除，可根据需要保留或删除
- 所有页面共用同一个logger.js和api.js，修改时需注意影响范围
- 历史对话和日志功能已从edit.js中移除，现在各自独立运行
